<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STOCK BARANG SARUNG - Admin</title>

<style>
/* --- RESET & BASE STYLES --- */
* { box-sizing: border-box; }
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background:#eef2f5;
    margin:0;
    color: #333;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}

/* --- LOGIN SCREEN --- */
#login-screen {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: #0d47a1; /* Deep Blue */
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}
.login-box {
    background: white;
    padding: 40px;
    border-radius: 8px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    text-align: center;
    width: 90%;
    max-width: 400px;
}
.login-box h2 { color: #0d47a1; margin-bottom: 20px; }
.login-box input {
    width: 100%; padding: 12px; margin-bottom: 15px;
    border: 1px solid #ccc; border-radius: 4px; font-size: 16px;
}
.login-box button {
    width: 100%; padding: 12px; background: #0d47a1; color: white;
    border: none; border-radius: 4px; font-size: 16px; cursor: pointer;
}
.login-box button:hover { background: #002171; }
.error-msg { color: red; font-size: 0.9rem; margin-top: 10px; display: none; }

/* --- MAIN APP --- */
#app-container { display: none; } /* Hidden by default */

header {
    background: #0d47a1;
    color: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
header h1 { margin: 0; font-size: 1.4rem; letter-spacing: 1px; }
header .logout-btn {
    background: rgba(255,255,255,0.2); border: 1px solid white;
    color: white; padding: 5px 15px; border-radius: 4px; cursor: pointer;
    font-size: 0.9rem;
}
header .logout-btn:hover { background: rgba(255,255,255,0.4); }

.container {
    max-width:1200px;
    margin:20px auto;
    padding:0 15px;
    display: grid;
    grid-template-columns: 1fr 2fr; /* Layout 1/3 dan 2/3 */
    gap: 20px;
}

/* Responsive Grid */
@media (max-width: 900px) {
    .container { grid-template-columns: 1fr; }
}

/* --- CARDS & PANELS --- */
.card {
    background:white;
    padding:20px;
    border-radius:6px;
    box-shadow:0 1px 3px rgba(0,0,0,0.1);
    margin-bottom:20px;
    border-top: 4px solid #0d47a1; /* Blue accent top */
}
.card.profit-card { border-top-color: #2e7d32; } /* Green accent for profit */
.card h2 {
    margin-top: 0; font-size: 1.1rem; color: #0d47a1;
    border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px;
}

/* --- FORMS --- */
.form-group { margin-bottom: 15px; }
label { display: block; font-size: 0.85rem; font-weight: bold; margin-bottom: 5px; color: #555; }
input {
    width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;
    font-size: 1rem;
}
input:focus { border-color: #0d47a1; outline: none; }
.btn-action {
    width: 100%; padding: 12px; border: none; border-radius: 4px;
    cursor: pointer; font-weight: bold; color: white; font-size: 1rem;
    transition: 0.2s;
}
.btn-buy { background-color: #0d47a1; }
.btn-buy:hover { background-color: #002171; }
.btn-sell { background-color: #2e7d32; }
.btn-sell:hover { background-color: #1b5e20; }
.btn-reset { background-color: #c62828; margin-top: 10px; font-size: 0.9rem; padding: 8px; }
.btn-reset:hover { background-color: #b71c1c; }

/* --- DASHBOARD WIDGETS --- */
.dashboard-stats {
    display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;
}
.stat-box {
    background: white; padding: 15px; border-radius: 6px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align: center;
}
.stat-box h4 { margin: 0 0 5px 0; color: #777; font-size: 0.85rem; }
.stat-box .val { font-size: 1.2rem; font-weight: bold; color: #333; }
.val.profit { color: #2e7d32; }

/* --- TABLES --- */
table { width: 100%; border-collapse: collapse; margin-top: 5px; font-size: 0.9rem; }
th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
th { background: #f8f9fa; color: #444; font-weight: 600; }
/* Align numbers right */
td:nth-child(2), td:nth-child(3), td:nth-child(4), td:nth-child(5),
th:nth-child(2), th:nth-child(3), th:nth-child(4), th:nth-child(5) { text-align: right; }
tr:hover { background-color: #f1f8e9; }
.profit-positive { color: #2e7d32; font-weight: bold; }
</style>
</head>

<body>

<!-- LOGIN SCREEN -->
<div id="login-screen">
    <div class="login-box">
        <h2>STOCK BARANG SARUNG</h2>
        <p style="color:#666; margin-bottom:20px;">Area Admin Terproteksi</p>
        <input type="password" id="adminPassword" placeholder="Masukkan Password Admin" onkeypress="handleEnter(event)">
        <button onclick="cekLogin()">MASUK APLIKASI</button>
        <div id="loginError" class="error-msg">Password Salah!</div>
    </div>
</div>

<!-- MAIN APPLICATION -->
<div id="app-container">
    <header>
        <div>
            <h1>STOCK BARANG SARUNG</h1>
            <small style="opacity: 0.8;">Metode FIFO & Manajemen Keuntungan</small>
        </div>
        <button class="logout-btn" onclick="logout()">Keluar</button>
    </header>

    <div class="container">
        
        <!-- LEFT COLUMN: INPUTS -->
        <div class="left-col">
            <!-- Stats for Mobile/Quick View -->
            <div class="dashboard-stats">
                <div class="stat-box">
                    <h4>Total Stok</h4>
                    <div class="val" id="dashStok">0</div>
                </div>
                <div class="stat-box">
                    <h4>Total Aset</h4>
                    <div class="val" id="dashAset">Rp 0</div>
                </div>
                <div class="stat-box">
                    <h4>Total Laba</h4>
                    <div class="val profit" id="dashLaba">Rp 0</div>
                </div>
            </div>

            <!-- Input Pembelian -->
            <div class="card">
                <h2>ðŸ“¥ Input Pembelian (Stok Masuk)</h2>
                <div class="form-group">
                    <label>Tanggal</label>
                    <input type="date" id="tglBeli">
                </div>
                <div class="form-group">
                    <label>Jumlah (Pcs/Lusin)</label>
                    <input type="number" id="qtyBeli" placeholder="Contoh: 10">
                </div>
                <div class="form-group">
                    <label>Harga Beli Per Unit</label>
                    <input type="number" id="hargaBeli" placeholder="Harga Modal Per Unit">
                </div>
                <button class="btn-action btn-buy" onclick="tambahPembelian()">SIMPAN PEMBELIAN</button>
            </div>

            <!-- Input Penjualan -->
            <div class="card" style="border-top-color: #ff6f00;">
                <h2>ðŸ“¤ Input Penjualan (Kasir)</h2>
                <div class="form-group">
                    <label>Tanggal Jual</label>
                    <input type="date" id="tglJual">
                </div>
                <div class="form-group">
                    <label>Jumlah Jual</label>
                    <input type="number" id="qtyJual" placeholder="Jumlah Terjual">
                    <small style="color:#666; font-size:0.75rem;">Stok Tersedia: <b id="stokRealtime">0</b></small>
                </div>
                <div class="form-group">
                    <label>Harga Jual Per Unit</label>
                    <input type="number" id="hargaJual" placeholder="Harga Jual ke Customer">
                </div>
                <button class="btn-action btn-sell" onclick="tambahPenjualan()">PROSES PENJUALAN</button>
            </div>
            
            <button class="btn-action btn-reset" onclick="resetData()">âš  RESET DATA APLIKASI</button>
        </div>

        <!-- RIGHT COLUMN: REPORTS -->
        <div class="right-col">
            
            <!-- Tabel Stok -->
            <div class="card">
                <h2>ðŸ“¦ Kartu Stok FIFO</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Tgl Masuk</th>
                            <th>Stok</th>
                            <th>Harga Modal</th>
                            <th>Nilai Aset</th>
                        </tr>
                    </thead>
                    <tbody id="stokTabel"></tbody>
                </table>
            </div>

            <!-- Tabel Laba Rugi (Keuntungan) -->
            <div class="card profit-card">
                <h2>ðŸ“ˆ Laporan Penjualan & Keuntungan</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Qty</th>
                            <th>Total HPP</th>
                            <th>Total Omset</th>
                            <th>Laba Bersih</th>
                        </tr>
                    </thead>
                    <tbody id="labaTabel"></tbody>
                </table>
            </div>

        </div>
    </div>
</div>

<script>
    // --- KONFIGURASI DAN STATE ---
    const PASSWORD_BENAR = "Admin123";
    let stok = JSON.parse(localStorage.getItem("stokSarung")) || [];
    let penjualan = JSON.parse(localStorage.getItem("jualSarung")) || [];

    // --- FUNGSI LOGIN ---
    function cekLogin() {
        const input = document.getElementById("adminPassword").value;
        const errorMsg = document.getElementById("loginError");
        
        if (input === PASSWORD_BENAR) {
            document.getElementById("login-screen").style.display = "none";
            document.getElementById("app-container").style.display = "block";
            initApp();
        } else {
            errorMsg.style.display = "block";
            document.getElementById("adminPassword").value = "";
            document.getElementById("adminPassword").focus();
        }
    }

    function handleEnter(e) {
        if (e.key === "Enter") cekLogin();
    }

    function logout() {
        location.reload(); // Reload halaman untuk kembali ke layar login
    }

    // --- INISIALISASI ---
    function initApp() {
        // Set tanggal hari ini
        const today = new Date().toISOString().split('T')[0];
        document.getElementById("tglBeli").value = today;
        document.getElementById("tglJual").value = today;
        
        tampilSemua();
    }

    // --- UTILITAS FORMAT RUPIAH ---
    const formatRupiah = (angka) => {
        return new Intl.NumberFormat("id-ID", {
            style: "currency",
            currency: "IDR",
            minimumFractionDigits: 0
        }).format(angka);
    };

    // --- LOGIKA UTAMA ---

    function simpanData() {
        localStorage.setItem("stokSarung", JSON.stringify(stok));
        localStorage.setItem("jualSarung", JSON.stringify(penjualan));
        tampilSemua();
    }

    function tampilSemua() {
        tampilStok();
        tampilLaba();
        updateDashboard();
    }

    function updateDashboard() {
        const totalQty = stok.reduce((a, b) => a + b.qty, 0);
        const totalAset = stok.reduce((a, b) => a + (b.qty * b.harga), 0);
        const totalLaba = penjualan.reduce((a, b) => a + (b.laba || 0), 0);

        document.getElementById("dashStok").innerText = totalQty;
        document.getElementById("dashAset").innerText = formatRupiah(totalAset);
        document.getElementById("dashLaba").innerText = formatRupiah(totalLaba);
        document.getElementById("stokRealtime").innerText = totalQty;
    }

    function tambahPembelian() {
        const tgl = document.getElementById("tglBeli").value;
        const qty = parseInt(document.getElementById("qtyBeli").value);
        const harga = parseInt(document.getElementById("hargaBeli").value);

        if (!tgl || qty <= 0 || harga <= 0) {
            alert("Data pembelian tidak lengkap!");
            return;
        }

        stok.push({ tgl, qty, harga });
        simpanData();
        
        document.getElementById("qtyBeli").value = "";
        document.getElementById("hargaBeli").value = "";
        alert("Stok berhasil ditambahkan.");
    }

    function tambahPenjualan() {
        const tgl = document.getElementById("tglJual").value;
        const qtyInput = parseInt(document.getElementById("qtyJual").value);
        const hargaJualUnit = parseInt(document.getElementById("hargaJual").value);

        if (!tgl || qtyInput <= 0 || isNaN(hargaJualUnit) || hargaJualUnit <= 0) {
            alert("Lengkapi data penjualan (Termasuk Harga Jual)!");
            return;
        }

        // 1. Cek Stok
        let sedia = stok.reduce((a, b) => a + b.qty, 0);
        if (qtyInput > sedia) {
            alert(`Stok Kurang! Maksimal jual: ${sedia}`);
            return;
        }

        // 2. Proses FIFO (Hitung HPP)
        let qtySisa = qtyInput;
        let totalHPP = 0;

        for (let i = 0; i < stok.length && qtySisa > 0; i++) {
            if (stok[i].qty <= qtySisa) {
                totalHPP += stok[i].qty * stok[i].harga;
                qtySisa -= stok[i].qty;
                stok[i].qty = 0;
            } else {
                totalHPP += qtySisa * stok[i].harga;
                stok[i].qty -= qtySisa;
                qtySisa = 0;
            }
        }
        stok = stok.filter(s => s.qty > 0);

        // 3. Hitung Keuntungan
        const totalOmzet = qtyInput * hargaJualUnit;
        const labaBersih = totalOmzet - totalHPP;

        // 4. Simpan Data Penjualan
        penjualan.push({
            tgl,
            qty: qtyInput,
            hpp: totalHPP,
            omzet: totalOmzet,
            laba: labaBersih
        });

        simpanData();
        alert("Penjualan Berhasil! Laba: " + formatRupiah(labaBersih));
        
        // Reset form jual
        document.getElementById("qtyJual").value = "";
        document.getElementById("hargaJual").value = "";
    }

    // --- TAMPILAN TABEL ---
    
    function tampilStok() {
        const tbody = document.getElementById("stokTabel");
        tbody.innerHTML = "";
        if (stok.length === 0) {
            tbody.innerHTML = "<tr><td colspan='4' align='center' style='color:#999; padding:20px;'>Stok Kosong</td></tr>";
            return;
        }
        stok.forEach((s, idx) => {
            const highlight = idx === 0 ? "background:#e8f5e9; font-weight:bold;" : "";
            tbody.innerHTML += `
                <tr style="${highlight}">
                    <td>${s.tgl} ${idx===0?'<small>(FIFO Head)</small>':''}</td>
                    <td>${s.qty}</td>
                    <td>${formatRupiah(s.harga)}</td>
                    <td>${formatRupiah(s.qty * s.harga)}</td>
                </tr>`;
        });
    }

    function tampilLaba() {
        const tbody = document.getElementById("labaTabel");
        tbody.innerHTML = "";
        if (penjualan.length === 0) {
            tbody.innerHTML = "<tr><td colspan='5' align='center' style='color:#999; padding:20px;'>Belum ada transaksi penjualan</td></tr>";
            return;
        }
        // Tampilkan data terbaru di paling atas
        [...penjualan].reverse().forEach(j => {
            tbody.innerHTML += `
                <tr>
                    <td>${j.tgl}</td>
                    <td>${j.qty}</td>
                    <td>${formatRupiah(j.hpp)}</td>
                    <td>${formatRupiah(j.omzet)}</td>
                    <td class="profit-positive">+ ${formatRupiah(j.laba)}</td>
                </tr>`;
        });
    }

    function resetData() {
        if(confirm("PERINGATAN: Semua data stok dan penjualan akan dihapus permanen. Lanjutkan?")) {
            localStorage.clear();
            stok = [];
            penjualan = [];
            simpanData();
            alert("Aplikasi berhasil di-reset.");
        }
    }
</script>

</body>
</html>